<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Coordinate Transforms · EarthSciMLBase.jl</title><meta name="title" content="Coordinate Transforms · EarthSciMLBase.jl"/><meta property="og:title" content="Coordinate Transforms · EarthSciMLBase.jl"/><meta property="twitter:title" content="Coordinate Transforms · EarthSciMLBase.jl"/><meta name="description" content="Documentation for EarthSciMLBase.jl."/><meta property="og:description" content="Documentation for EarthSciMLBase.jl."/><meta property="twitter:description" content="Documentation for EarthSciMLBase.jl."/><meta property="og:url" content="https://EarthSciML.github.io/EarthSciMLBase.jl/coord_transforms/"/><meta property="twitter:url" content="https://EarthSciML.github.io/EarthSciMLBase.jl/coord_transforms/"/><link rel="canonical" href="https://EarthSciML.github.io/EarthSciMLBase.jl/coord_transforms/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">EarthSciMLBase.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../composition/">Composition</a></li><li><a class="tocitem" href="../operator_compose/">Operator Composition</a></li><li><a class="tocitem" href="../param_to_var/">Parameter Replacement</a></li><li><a class="tocitem" href="../icbc/">Initial and Boundary Conditions</a></li><li><a class="tocitem" href="../advection/">Advection</a></li><li class="is-active"><a class="tocitem" href>Coordinate Transforms</a></li><li><a class="tocitem" href="../operator/">Operators</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../example_all_together/">All Together</a></li></ul></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Coordinate Transforms</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Coordinate Transforms</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EarthSciML/EarthSciMLBase.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EarthSciML/EarthSciMLBase.jl/blob/main/docs/src/coord_transforms.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Coordinate-Transforms-for-Partial-Derivatives"><a class="docs-heading-anchor" href="#Coordinate-Transforms-for-Partial-Derivatives">Coordinate Transforms for Partial Derivatives</a><a id="Coordinate-Transforms-for-Partial-Derivatives-1"></a><a class="docs-heading-anchor-permalink" href="#Coordinate-Transforms-for-Partial-Derivatives" title="Permalink"></a></h1><p>Often, the coordinates of a grid may be defined in a different coordinate system than the one in which the partial derivatives are desired. For example, grids are often defined in latitude and longitude, but partial derivatives may be required in units of meters to correspond with wind speeds in meters per second.</p><p>To handle this, the <a href="../api/#EarthSciMLBase.DomainInfo"><code>DomainInfo</code></a> type can be used to define coordinate system transformations. To use it, a coordinate transform function first needs to be defined, for example <a href="../api/#EarthSciMLBase.partialderivatives_δxyδlonlat-Tuple{AbstractVector}"><code>partialderivatives_δxyδlonlat</code></a> which transforms partial derivatives from longitude and latitude to meters:</p><pre><code class="language-julia hljs">using EarthSciMLBase
using ModelingToolkit
using ModelingToolkit: t, D
using DomainSets
using DynamicQuantities

@parameters lon [unit = u&quot;rad&quot;]
@parameters lat [unit = u&quot;rad&quot;]
@parameters lev

partialderivatives_δxyδlonlat([lev, lon, lat])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Int64, Symbolics.Num} with 2 entries:
  2 =&gt; 1.0 / (lon2m*cos(lat))
  3 =&gt; 1.0 / lat2meters</code></pre><p>As you can see in the output of the code above, the function should take as arguments a list of the coordinates describing the grid (in the case above we have a 3-dimensional grid with vertical level, latitude, and longitude), and return a Dictionary relating the index of each coordinate with a factor to multiply the partial derivative by to convert it to the desired units. The function only needs to return factors for the coordinates that are being transformed.</p><p>To include a coordinate transform in our domain, we include the function in the <code>DomainInfo</code> constructor:</p><pre><code class="language-julia hljs">deg2rad(x) = x * π / 180.0
domain = DomainInfo(
    partialderivatives_δxyδlonlat,
    constIC(0.0, t ∈ Interval(0.0f0, 3600.0f0)),
    periodicBC(lat ∈ Interval(deg2rad(-90.0f0), deg2rad(90.0f0))),
    periodicBC(lon ∈ Interval(deg2rad(-180.0f0), deg2rad(180.0f0))),
    zerogradBC(lev ∈ Interval(1.0f0, 10.0f0))
);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DomainInfo{Float64}(Function[EarthSciMLBase.partialderivatives_δxyδlonlat], nothing, ICBCcomponent[constIC(0.0, Symbolics.VarDomainPairing(t, 0.0 .. 3600.0)), periodicBC(Symbolics.VarDomainPairing[Symbolics.VarDomainPairing(lat, -1.570796373155382 .. 1.570796373155382)]), periodicBC(Symbolics.VarDomainPairing[Symbolics.VarDomainPairing(lon, -3.141592746310764 .. 3.141592746310764)]), zerogradBC(Symbolics.VarDomainPairing[Symbolics.VarDomainPairing(lev, 1.0 .. 10.0)])], &quot;+proj=longlat +datum=WGS84 +no_defs&quot;, 0.0)</code></pre><p>Multiple functions can be included in the <code>DomainInfo</code> constructor, just by including them as a vector, e.g.:</p><pre><code class="language-julia hljs">domain = DomainInfo(
    [transform1, transform2, ...],
    constIC(0.0, t ∈ Interval(0.0f0, 3600.0f0)),
    ...
)</code></pre><p>After we include the coordinate transforms in our domain, in general everything should be handled automatically. The coordinate transforms may also be automatically added when different model components are coupled together, so you may not need to worry about them at all in many cases. However, if you would like to use the transformed partial derivatives, for example to create a new PDE equation system, you can get them using the <a href="../api/#EarthSciMLBase.partialderivatives-Tuple{DomainInfo}"><code>EarthSciMLBase.partialderivatives</code></a> function:</p><pre><code class="language-julia hljs">δs = partialderivatives(domain)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{EarthSciMLBase.var&quot;#40#42&quot;{Int64, Vector{Any}, Vector{Symbolics.Differential}}}:
 #40 (generic function with 1 method)
 #40 (generic function with 1 method)
 #40 (generic function with 1 method)</code></pre><p>This returns a list of functions, one corresponding to each coordinate in our domain. Then we can calculate the symbolic partial derivative of a variable by just calling each function:</p><pre><code class="language-julia hljs">@variables u(t)

[δs[i](u) for i in eachindex(δs)]</code></pre><p class="math-container">\[ \begin{equation}
\left[
\begin{array}{c}
\frac{\frac{\mathrm{d} u\left( t \right)}{\mathrm{d}lat}}{\mathtt{lat2meters}} \\
\frac{\frac{\mathrm{d} u\left( t \right)}{\mathrm{d}lon}}{\mathtt{lon2m} \cos\left( \mathtt{lat} \right)} \\
\frac{\mathrm{d} u\left( t \right)}{\mathrm{d}lev} \\
\end{array}
\right]
\end{equation}
 \]</p><p>You can see an example of how this is implemented in the source code for the <a href="../advection/#Advection"><code>Advection</code></a> model component.</p><p>Additional transformation functions may be defined in other packages. We recommend that the names of these functions start with <code>partialderivatives_</code> to make it clear that they are intended to be used in this context.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../advection/">« Advection</a><a class="docs-footer-nextpage" href="../operator/">Operators »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.3 on <span class="colophon-date" title="Thursday 15 May 2025 18:50">Thursday 15 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
